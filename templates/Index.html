{% extends "base.html" %}

{% block title %}
	–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
{% endblock %}

<body>
{% block content %}
	<header class="header" id="header">
		<div class="container">
			<div class="row d-flex align-items-center">	
				<div class="col-3 col-md-4 col-lg-2">
		  			<a href="index.html">
						<img class="img-fluid logo" src="{{url_for('static', filename='img/low.png')}}" alt="logo">
		  			</a>
				</div>
				<!-- –ü–æ–ª–µ –ø–æ—à—É–∫—É -->
				<div class="col-9 serh d-lg-flex col-md-8 col-lg-7 flex items-center">
					<div class="search-wrapper">
					  	<input type="text" placeholder="–ü–æ—à—É–∫..." class="search-input" />
					  	<button class="search-button">üîç</button>
					</div>
				</div>
				<div class="col-12 reg-in col-md-12 d-lg-flex col-lg-3 justify-content-end align-items-center menu-collapse">
		  			<!-- –ú–µ–Ω—é -->
		  			<nav class="menu">
						<ul class="menu__list d-flex">
							<li class="menu__item">
								<a class="menu__registr" href="#">–†–µ–µ—Å—Ç—Ä–∞—Ü—ñ—è</a>
							</li>
							<li class="menu__item">
								<a class="menu__exit" href="#">–í—Ö—ñ–¥</a>
							</li>
						</ul>
		  			</nav>
				</div>
			</div>
		</div>
	</header>

	<section class="offer" id="offer" data-type="background" data-speed="5">
		<div class="header-back">
			
		</div>
		<div class="back">
			
		</div>
		<div class="container">
			<div class="row">
				<div class="col-12">
					<h1 class="offer-title">
						–ö–æ–º—É–Ω–∞–ª—å–Ω–∏–π –∑–∞–∫–ª–∞–¥ <br>
						"–¢–∞—Ç–∞—Ä–±—É–Ω–∞—Ä—Å—å–∫–∏–π –±—É–¥–∏–Ω–æ–∫ –¥–∏—Ç—è—á–æ—ó —Ç–∞ —é–Ω–∞—Ü—å–∫–æ—ó —Ç–≤–æ—Ä—á–æ—Å—Ç—ñ" <br>
						–¢–∞—Ç–∞—Ä–±—É–Ω–∞—Ä—Å—å–∫–æ—ó  –º—ñ—Å—å–∫–æ—ó  —Ä–∞–¥–∏  –û–¥–µ—Å—å–∫–æ—ó  –æ–±–ª–∞—Å—Ç—ñ
					</h1>
					<p class="offer-desc">
						–ë—É–¥–∏–Ω–æ–∫ —Ç–≤–æ—Ä—á–æ—Å—Ç—ñ, –Ω–∞—à —Ä—ñ–¥–Ω–∏–π –¥—ñ–º,<br>
						–ì–æ—Å—Ç–∏–Ω–Ω–æ –¥–≤–µ—Ä—ñ —Ç–∏ –Ω–∞–º –≤—ñ–¥—á–∏–Ω—è—î—à.<br>
						–ó—ñ–≥—Ä—ñ—Ç—ñ –º–∏ –ª—é–±–æ–≤‚Äô—é —ñ —Ç–µ–ø–ª–æ–º —Ç–≤–æ—ó–º,<br>
						–ü—Ä–µ–∫—Ä–∞—Å–Ω–∏–º–∏ –ª—é–¥—å–º–∏<br>
						—É —Å—Ç—ñ–Ω–∞—Ö —Ü–∏—Ö –∑—Ä–æ—Å—Ç–∞—î–º.
					</p>
				</div>
			</div>
		</div>
	</section>

	<section class="cal">
		<div class="container">
			<div class="row">
				<div class="center d-flex col-sm-12 col-md-6"> 
					<div class="calendar-wrapper">
						<button id="btnPrev" type="button">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π</button>
						<button id="btnNext" type="button">–ù–∞—Å—Ç—É–ø–Ω–∏–π</button>
						<div id="divCal">
							
						</div>
						<a href="#" class="podii-2">–í—Å—ñ –ø–æ–¥—ñ—ñ —Ü—å–æ–≥–æ –º—ñ—Å—è—Ü—è</a>
					</div>
					<script type="text/javascript">
						var Cal = function(divId) {
							this.divId = divId;
							//–î–Ω—ñ —Ç–∏–∂–Ω—è –∑ –ø–æ–Ω–µ–¥—ñ–ª–∫–∞
							this.DaysOfWeek = [
								'–ü–Ω', 
								'–í—Ç', 
								'–°—Ä', 
								'–ß—Ç', 
								'–ü—Ç', 
								'–°–±', 
								'–ù–¥'
							];
							// –ú—ñ—Å—è—Ü—ñ –ø–æ—á–∏–Ω–∞—è –∑ —Å—ñ—á–Ω—è
							this.Months = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
							// –ü–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü, —Ä—ñ–∫
							var d = new Date();
							this.currMonth = d.getMonth();
							this.currYear = d.getFullYear();
							this.currDay = d.getDate();
							this.events = [];
						};
						// –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
						Cal.prototype.fetchEvents = async function() {
							try {
								const response = await fetch('/api/events', {
									method: 'GET',
									headers: {
										'Content-Type': 'application/json'
									}
								});
								this.events = await response.json();
								console.log('–ü–æ–¥—ñ—ó –∑ API (index.html):', this.events);
							} catch (error) {
								console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø–æ–¥—ñ–π:', error);
							}
						};

						Cal.prototype.nextMonth = function() {
							if (this.currMonth == 11) {
								this.currMonth = 0;
								this.currYear = this.currYear + 1;
							} else {
								this.currMonth = this.currMonth + 1;
							}
							this.showcurr();
						};
						// –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –º—ñ—Å—è—Ü—è
						Cal.prototype.previousMonth = function() {
							if (this.currMonth == 0) {
								this.currMonth = 11;
								this.currYear = this.currYear - 1;
							} else {
								this.currMonth = this.currMonth - 1;
							}
							this.showcurr();
						};

						// –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å
						Cal.prototype.showcurr = function() {
							this.showMonth(this.currYear, this.currMonth);
						};
						// –ü–æ–∫–∞–∑–∞—Ç–∏ –º—ñ—Å—è—Ü—å (—Ä—ñ–∫, –º—ñ—Å—è—Ü—å)
						Cal.prototype.showMonth = function(y, m) {
							var d = new Date();
							// –ü–µ—Ä—à–∏–π –¥–µ–Ω—å –Ω–µ–¥—ñ–ª—ñ –≤ –æ–±—Ä–∞–Ω–æ–º—É –º—ñ—Å—è—Ü—ñ
							var firstDayOfMonth = new Date(y, m, 7).getDay();
							// –û—Å—Ç–∞–Ω–Ω—ñ–π –¥–µ–Ω—å –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –º—ñ—Å—è—Ü—è
							var lastDateOfMonth = new Date(y, m + 1, 0).getDate();
							var lastDayOfLastMonth = m == 0 ? new Date(y - 1, 11, 0).getDate() : new Date(y, m, 0).getDate();

							var html = '<table>';
							// –ó–∞–ø–∏—Å –æ–±—Ä–∞–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è —ñ —Ä–æ–∫—É
							html += '<thead><tr>';
							html += '<td colspan="7">' + this.Months[m] + ' ' + y + '</td>';
							html += '</tr></thead>';
							// –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–Ω—ñ–≤ –Ω–µ–¥—ñ–ª—ñ
							html += '<tr class="days">';
							for (var i = 0; i < this.DaysOfWeek.length; i++) {
								html += '<td>' + this.DaysOfWeek[i] + '</td>';
							}
							html += '</tr>';
							// –ó–∞–ø–∏—Å—É—î–º–æ –¥–Ω—ñ
							var i = 1;
							do {
								var dow = new Date(y, m, i).getDay();
								// –ü–æ—á–∞—Ç–∏ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫ –∑ –ø–æ–Ω–µ–¥—ñ–ª–∫–∞
								if (dow == 1) {
									html += '<tr>';
								} 
								// –Ø–∫—â–æ –ø–µ—Ä—à–∏–π –¥–µ–Ω—å –Ω–µ–¥—ñ–ª—ñ –Ω–µ –ø–æ–Ω–µ–¥—ñ–ª–æ–∫, —Ç–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –¥–Ω—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –º—ñ—Å—è—Ü—è
								else if (i == 1) {
									html += '<tr>';
									var k = lastDayOfLastMonth - firstDayOfMonth + 1;
									for (var j = 0; j < firstDayOfMonth; j++) {
										html += '<td class="not-current">' + k + '</td>';
										k++;
									}
								}
								// –ó–∞–ø–∏—Å—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –¥–µ–Ω—å —É —Ü–∏–∫–ª
								var currentDate = new Date(y, m, i);
								var hasEvent = this.events.some(event => {
									var eventDate = new Date(event.date);
									return eventDate.getFullYear() === y &&
										   eventDate.getMonth() === m &&
										   eventDate.getDate() === i;
								});

								var chk = new Date();
								var chkY = chk.getFullYear();
								var chkM = chk.getMonth();
								if (chkY == this.currYear && chkM == this.currMonth && i == this.currDay) {
									html += `<td class="today${hasEvent ? ' event-day' : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
								} else {
									html += `<td class="normal${hasEvent ? ' event-day' : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
								}
								// –ó–∞–∫—Ä–∏–≤–∞—î–º–æ —Ä—è–¥–æ–∫ —É –Ω–µ–¥—ñ–ª—é
								if (dow == 0) {
									html += '</tr>';
								} 
								// –Ø–∫—â–æ –æ—Å—Ç–∞–Ω–Ω—ñ–π –¥–µ–Ω—å –º—ñ—Å—è—Ü—è –Ω–µ –Ω–µ–¥—ñ–ª—è, —Ç–æ –ø–æ–∫–∞–∑—É—î–º–æ –ø–µ—Ä—à—ñ –¥–Ω—ñ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
								else if (i == lastDateOfMonth) {
									var k = 1;
									for (dow; dow < 7; dow++) {
										html += '<td class="not-current">' + k + '</td>';
										k++;
									}
								}
								i++;
							} 
							while (i <= lastDateOfMonth);
							// –ö—ñ–Ω–µ—Ü—å —Ç–∞–±–ª–∏—Ü—ñ
							html += '</table>';
							// –ó–∞–ø–∏—Å—É—î–º–æ HTML —É div
							document.getElementById(this.divId).innerHTML = html;
						};
						// –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–Ω–Ω—ñ –≤—ñ–∫–Ω–∞
						Cal.prototype.showDayEvents = function(year, month, day) {
							const selectedDate = new Date(year, month, day);
							const dayOfWeek = this.DaysOfWeek[selectedDate.getDay() === 0 ? 6 : selectedDate.getDay() - 1];
							const dateStr = `${day} ${this.Months[month].toUpperCase()} ${year} - ${dayOfWeek}`;
							document.querySelector('#exampleModal-3 .date p').textContent = dateStr;

							const eventsOnDay = this.events.filter(event => {
								const eventDate = new Date(event.date);
								return eventDate.getFullYear() === year &&
									   eventDate.getMonth() === month &&
									   eventDate.getDate() === day;
							});

							const eventContainer = document.querySelector('#exampleModal-3 .event-details');
							eventContainer.innerHTML = '';

							if (eventsOnDay.length > 0) {
								eventsOnDay.forEach(event => {
									const eventDate = new Date(event.date);
									const timeStr = eventDate.toTimeString().slice(0, 5);
									const eventHtml = `
										<div>
											<h2 class="event-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'}</h2>
											<i><p class="event-desc">–ß–∞—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è: ${timeStr}</p></i>
										</div>
									`;
									eventContainer.innerHTML += eventHtml;
								});
							} else {
								eventContainer.innerHTML = `
									<div class="desc-date">
										<p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∏—Ö –ø–æ–¥—ñ–π</p>
									</div>
								`;
							}

							$.arcticmodal({
								content: '#exampleModal-3'
							});
						};

						Cal.prototype.showMonthEvents = function() {
							const monthStr = `${this.Months[this.currMonth]} ${this.currYear}`;
							document.querySelector('#exampleModal-4 .date p').textContent = monthStr;

							const lastDateOfMonth = new Date(this.currYear, this.currMonth + 1, 0).getDate();
							const eventList = document.querySelector('#exampleModal-4 .list-event');
							eventList.innerHTML = '';

							for (let day = 1; day <= lastDateOfMonth; day++) {
								const eventsOnDay = this.events.filter(event => {
									const eventDate = new Date(event.date);
									return eventDate.getFullYear() === this.currYear &&
										   eventDate.getMonth() === this.currMonth &&
										   eventDate.getDate() === day;
								});

								const li = document.createElement('li');
								if (eventsOnDay.length > 0) {
									li.className = 'activ-event-day';
									eventsOnDay.forEach(event => {
										const eventDate = new Date(event.date);
										const timeStr = eventDate.toTimeString().slice(0, 5);
										li.innerHTML = `
											<p>${day}</p>
											<p>${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'} (${timeStr})</p>
										`;
									});
								} else {
									li.innerHTML = `
										<p>${day}</p>
										<p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∞ –ø–æ–¥—ñ—è</p>
									`;
								}
								eventList.appendChild(li);
							}

							$.arcticmodal({
								content: '#exampleModal-4'
							});
						};

						let calendarInstance;
						window.onload = async function() {
							calendarInstance = new Cal("divCal");
							await calendarInstance.fetchEvents();
							calendarInstance.showcurr();

							getId('btnNext').onclick = function() {
								calendarInstance.nextMonth();
							};
							getId('btnPrev').onclick = function() {
								calendarInstance.previousMonth();
							};

							document.querySelector('.podii-2').onclick = function(e) {
								e.preventDefault();
								calendarInstance.showMonthEvents();
							};
						};

						function getId(id) {
							return document.getElementById(id);
						}
					</script>	
				</div>
				<div class="d-flex col-sm-12 col-md-6 main-slide m-auto">
					<div class="slide-block">
						<img src="{{url_for('static', filename='img/photo_2024-12-26_23-22-22.jpg')}}" class="slide-block__img"></img>
					</div>
					<div class="slide-block">
						<img src="{{url_for('static', filename='img/002.jpg')}}" class="slide-block__img"></img>
					</div>
					<div class="slide-block">
						<img src="{{url_for('static', filename='img/003.jpg')}}" class="slide-block__img"></img>
					</div>
				</div>
			</div>
		</div>
	</section>
{% endblock %}

{% block ModalWindows %}
	<!-- –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ -->
	<div style="display: none;"> <!-- –í—ñ–∫–Ω–æ —Ä–µ–µ—Å—Ç—Ä–∞—Ü—ñ—ó -->
		<div class="box-modal" id="exampleModal-1">
			<div class="box-modal_close arcticmodal-close">
				<img src="{{url_for('static', filename='img/close.png')}}">
			</div>
			<form method="POST" action="{{ url_for('register') }}" class="modal-1__form d-flex flex-column js-form" id="popupResult-1">
				<div class="modal-1__block-input d-flex flex-column">
					<input id="login-f1" class="modal-input" type="text" name="login" placeholder="–õ–æ–≥—ñ–Ω" required>
					<input id="name-f1" class="modal-input" type="text" name="name" placeholder="–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" required>
					<input id="surname-f1" class="modal-input" type="text" name="surname" placeholder="–ü—Ä–∏–∑–≤—ñ—â–µ" required>
					<input id="tel-f1" class="modal-input" type="text" name="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
					<select name="class" class="class"  required>
						<option value="0">–û–±–µ—Ä—ñ—Ç—å –∫–ª–∞—Å!</option>
						<option value="1">–ö–ª–∞—Å 1</option>
						<option value="2">–ö–ª–∞—Å 2</option>
						<option value="3">–ö–ª–∞—Å 3</option>
						<option value="4">–ö–ª–∞—Å 4</option>
						<option value="5">–ö–ª–∞—Å 5</option>
						<option value="6">–ö–ª–∞—Å 6</option>
					</select>
					<p class="radio-text">–•—Ç–æ –≤–∏?<br>–ó—Ä–æ–±—ñ—Ç—å —Å–≤—ñ–π –≤–∏–±—ñ—Ä!</p>
					<select name="role" class="class" required>
						<option value="student">–£—á–µ–Ω—å</option>
						<option value="parent">–ë–∞—Ç—å–∫–∏</option>
					</select>

<!--					<div class="container-radio d-flex">
						<div class="radio d-flex">
							<label for="radio-1" class="radio-label">–í—á–∏—Ç–µ–ª—å</label>
							<input id="radio-1" name="radio" type="radio">
						</div>
						<div class="radio d-flex">
							<label for="radio-2" class="radio-label">–£—á–µ–Ω—å</label>
							<input id="radio-2" name="radio" type="radio">
						</div>
						<div class="radio d-flex">
							<label for="radio-3" class="radio-label">–ë–∞—Ç—å–∫–∏</label>
							<input id="radio-3" name="radio" type="radio">
						</div>
					</div> -->

					<input type="password" id="pass-f1" class="modal-input" name="password" minlength="6" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å" required>
					<button class="button modal-button" type="data-submit">–†–µ–µ—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
				</div>
			</form>
		</div>
	</div>

	<div style="display: none;"> <!-- –í—ñ–∫–Ω–æ –≤—Ö–æ–¥—É -->
		<div class="box-modal" id="exampleModal-2">
			<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
			<form action="/success.php" class="modal-2__form d-flex flex-column js-form" id="popupResult-2">
				<div class="modal-2__block-input d-flex flex-column">
					<input id="name-f2" class="modal-input" type="text" name="name" placeholder="–õ–æ–≥—ñ–Ω">
					<input type="password" id="pass-f2" class="modal-input" name="password" minlength="6" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
				</div>
				<button class="button modal-button" data-submit>–£–≤—ñ–π—Ç–∏</button>
			</form>
		</div>
	</div>

	<div style="display: none;"> <!-- –í—ñ–∫–Ω–æ –∫–ª—ñ–∫–∞ –Ω–∞ –¥–Ω—ñ —É –∫–∞–ª–µ–Ω–¥–∞—Ä—ñ -->
		<div class="box-modal" id="exampleModal-3">
			<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
			<div>
				<div class="date">
					<p>–°—é–¥–∏ –ø–æ–≤–∏–Ω–Ω–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ –ø–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞</p>
				</div>
				<div class="event-details">
					<!-- –°—é–¥–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –¥–æ–¥–∞—é—Ç—å—Å—è –ø–æ–¥—ñ—ó -->
				</div>
			</div>
		</div>
	</div>

	<div style="display: none;"> <!-- –í—ñ–∫–Ω–æ —É—Å—ñ—Ö –∑–∞–≥–∞–ª—å–Ω–∏—Ö –ø–æ–¥—ñ–π -->
		<div class="box-modal" id="exampleModal-4">
			<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
			<div class="date">
				<p>–°—é–¥–∏ –ø–æ–≤–∏–Ω–Ω–µ–Ω –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å</p>
			</div>
			<ul class="list-event">
				<!-- –°—é–¥–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –¥–æ–¥–∞—é—Ç—å—Å—è –ø–æ–¥—ñ—ó -->
			</ul>
		</div>
	</div>
	<div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999;"></div>
{% endblock %}
</body>
</html>
