{% extends "base.html" %}

{% block title %}
	—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞
{% endblock %}

{% block content %}
<header class="header" id="header">
	<div class="container">
		<div class="row d-flex align-items-center">
			<div class="col-3 col-md-4 col-lg-2">
				<a href="index.html">
					<img class="img-fluid logo" src="{{url_for('static', filename='img/low.png')}}" alt="logo">
				</a>
			</div>
			<!-- –ü–æ–ª–µ –ø–æ—à—É–∫—É -->
			<div class="col-9 serh d-lg-flex col-md-8 col-lg-7 flex items-center">
				<div class="search-wrapper">
					<input type="text" placeholder="–ü–æ—à—É–∫..." class="search-input" />
					<button class="search-button">üîç</button>
				</div>
			</div>
			<div class="col-12 reg-in col-md-12 d-lg-flex col-lg-3 justify-content-end align-items-center menu-collapse">
				<!-- –ú–µ–Ω—é -->
				<nav class="menu">
					<ul class="menu__list d-flex">
						<li class="menu__item">
							<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p> <!-- –°—é–¥–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ –¥–∞–Ω—ñ –∑ —Ñ–æ—Ä–º–∏ —Ä–µ–µ—Å—Ç—Ä–∞—Ü—ñ—ó -->
						</li>
					</ul>
				</nav>
			</div>
		</div>
	</div>
</header>

<section class="cal-2">
	<div class="container">
		<div class="row">
			<div class="center d-flex col-sm-12 col-md-6"> 
				<div class="calendar-wrapper">
					<div class="calendar-header">
						<button id="btnPrev" type="button">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π</button>
						<span id="monthYear"></span>
						<button id="btnNext" type="button">–ù–∞—Å—Ç—É–ø–Ω–∏–π</button>
					</div>
					<div id="divCal" class="calendar-table"></div>
					<div class="calendar-buttons">
						<a href="#" class="podii-2">–í—Å—ñ –ø–æ–¥—ñ—ó —Ü—å–æ–≥–æ –º—ñ—Å—è—Ü—è</a>
						<a href="#" class="task-for-one">–°—Ç–≤–æ—Ä–∏—Ç–∏ –æ—Å–æ–±–∏—Å—Ç–µ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
						<a href="#" class="task-for-group">–°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
						<a href="#" class="assessment">–û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è</a>
					</div>
				</div>
			</div>
			<div class="center col-sm-12 col-md-6"> 
				<div class="students">
					<div class="students-title">
						<h2>–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∏–π –∫–ª–∞—Å</h2>
						<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
					</div>
					<ul class="stud-list">
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
						<li class="student-item"><p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p></li>
					</ul>
					<a href="#" class="remove-student">–í–∏–¥–∞–ª–∏—Ç–∏ —É—á–Ω—è –∑ –±–∞–∑–∏</a>
				</div>
			</div>
			<div class="col-12 d-flex justify-content-center">
				<a href="#" class="general-event">–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é</a>
			</div>	
		</div>
	</div>
</section>
{% endblock %}

{% block ModalWindows %}
<!-- –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ -->
<div style="display: none;">
	<div class="box-modal" id="exampleModal-3">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<div>
			<div class="date">
				<p id="selectedDate"></p>
			</div>
			<div class="desc-date" id="eventDetails">
				<p>–ü–æ–¥—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
			</div>
		</div>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-5">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<div class="date">
			<p id="currentMonth"></p>
		</div>
		<ul class="list-event" id="eventList"></ul>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-6">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<div>
			<textarea class="desk-task" name="desk-task" placeholder="–û–ø–∏—à—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è"></textarea>
			<select name="class" class="class">
				<option value="0">–û–±–µ—Ä—ñ—Ç—å —É—á–Ω—è</option>
				<option value="1">–£—á–µ–Ω—å 1</option>
				<option value="2">–£—á–µ–Ω—å 2</option>
				<option value="3">–£—á–µ–Ω—å 3</option>
				<option value="4">–£—á–µ–Ω—å 4</option>
				<option value="5">–£—á–µ–Ω—å 5</option>
				<option value="6">–£—á–µ–Ω—å 6</option>
			</select>
			<div>
				<p class="example_task-date">–°—Ç—Ä–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ: <br>
					<span><input id="namb" class="namb-input" type="text" name="namber" placeholder="–ó–∞–±—Ä–æ–Ω—é–π—Ç–µ –¥–∞—Ç—É –≤—ñ–∫–æ–Ω–∞–Ω–Ω—è"></span></p>
			</div>
			<a href="#" class="task-gr">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
		</div>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-7">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<div>
			<textarea class="desk-task" name="desk-task" placeholder="–û–ø–∏—à—ñ—Ç—å –∑–∞–≤–¥–∞–Ω–Ω—è"></textarea>
			<h3 class="st-task-gr">–í–∏–±–µ—Ä—ñ—Ç—å —É—á–Ω—ñ–≤:</h3>
			<ul class="stud-list-2 d-flex">
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
				<li class="student-item d-flex">
					<input type="checkbox">
					<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
				</li>
			</ul>
			<div>
				<p class="example_task-date">–°—Ç—Ä–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ: <br>
					<span><input id="namb" class="namb-input" type="text" name="namber" placeholder="–ó–∞–±—Ä–æ–Ω—é–π—Ç–µ –¥–∞—Ç—É –≤—ñ–∫–æ–Ω–∞–Ω–Ω—è"></span>
				</p>
				<a href="#" class="task-gr">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</a>
			</div>
		</div>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-8">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<div>
			<textarea class="desk-task" name="desk-task" placeholder="–ö–æ–º–µ–Ω—Ç–∞—Ä –≤—á–∏—Ç–µ–ª—è"></textarea>
			<span class="warning">
				* –Ø–∫—â–æ –∑–∞–ª–∏—à–∏—Ç–∏ –ø–æ–ª–µ –ø—É—Å—Ç–∏–º, <br>
				—Ç–æ –æ—Ü—ñ–Ω–∫–∞ –±—É–¥–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—å–∏—Å—å <br>
				—è–∫ –∑–∞ –≥—É—Ä—Ç–æ–≤–µ –∑–∞–≤–¥–∞–Ω–Ω—è
			</span>	
			<select name="class" class="class-2">
				<option value="0">–û–±–µ—Ä—ñ—Ç—å —É—á–Ω—è</option>
				<option value="1">–£—á–µ–Ω—å 1</option>
				<option value="2">–£—á–µ–Ω—å 2</option>
				<option value="3">–£—á–µ–Ω—å 3</option>
				<option value="4">–£—á–µ–Ω—å 4</option>
				<option value="5">–£—á–µ–Ω—å 5</option>
				<option value="6">–£—á–µ–Ω—å 6</option>
			</select>
			<div>
				<p class="d-flex justify-content-center grade-block">
					–ü–æ—Å—Ç–∞–≤–∏—Ç–∏ –æ—Ü—ñ–Ω–∫—É: <input type="number" class="grade">
				</p>
			</div>
			<a href="#" class="task-grade">–û—Ü—ñ–Ω–∏—Ç–∏</a>
		</div>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-9">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<h3>–û–±–µ—Ä—ñ—Ç—å —É—á–Ω—è/—É—á–Ω—ñ–≤ —ñ–∑ —Å–ø–∏—Å–∫—É:</h3>
		<ul class="stud-list-2 d-flex">
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
			<li class="student-item d-flex">
				<input type="checkbox">
				<p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
			</li>
		</ul>
		<a href="#" class="delete">–í–∏–¥–∞–ª–∏—Ç–∏ –≤–∏–±—Ä–∞–Ω–∏—Ö</a>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-10">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<h2 id="formTitle" style="text-align: center;">–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é</h2>
		<div class="form">
			<input type="hidden" id="eventId">
			<div class="input-box">
				<label>–ù–∞–∑–≤–∞ –ø–æ–¥—ñ—ó</label>
				<input type="text" id="eventTitle" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø–æ–¥—ñ—ó">
			</div>
			<div class="input-box">
				<label>–î–∞—Ç–∞ —ñ —á–∞—Å</label>
				<input type="text" id="eventDate" placeholder="–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —ñ —á–∞—Å">
			</div>
			<div class="button">
				<button onclick="saveEvent(event)">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
			</div>
		</div>
	</div>
</div>

<div style="display: none;">
	<div class="box-modal" id="exampleModal-11">
		<div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
		<div>
			<div class="date">
				<p id="selectedDateEvent"></p>
			</div>
			<div class="desc-date" id="eventDetailsEvent">
				<p>–ü–æ–¥—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	var Cal = function(divId) {
		this.divId = divId;
		this.DaysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥'];
		this.Months = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
		var d = new Date();
		this.currMonth = d.getMonth();
		this.currYear = d.getFullYear();
		this.currDay = d.getDate();
		this.events = [];
	};

	Cal.prototype.fetchEvents = async function() {
		try {
			const response = await fetch('/api/events', {
				method: 'GET',
				headers: {
					'Content-Type': 'application/json'
				}
			});
			this.events = await response.json();
			console.log('–ü–æ–¥—ñ—ó –∑ API:', this.events);
		} catch (error) {
			console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø–æ–¥—ñ–π:', error);
		}
	};

	Cal.prototype.nextMonth = function() {
		if (this.currMonth == 11) {
			this.currMonth = 0;
			this.currYear = this.currYear + 1;
		} else {
			this.currMonth = this.currMonth + 1;
		}
		this.showcurr();
	};

	Cal.prototype.previousMonth = function() {
		if (this.currMonth == 0) {
			this.currMonth = 11;
			this.currYear = this.currYear - 1;
		} else {
			this.currMonth = this.currMonth - 1;
		}
		this.showcurr();
	};

	Cal.prototype.showcurr = function() {
		this.showMonth(this.currYear, this.currMonth);
	};

	Cal.prototype.showMonth = function(y, m) {
		var d = new Date();
		var firstDayOfMonth = new Date(y, m, 7).getDay();
		var lastDateOfMonth = new Date(y, m + 1, 0).getDate();
		var lastDayOfLastMonth = m == 0 ? new Date(y - 1, 11, 0).getDate() : new Date(y, m, 0).getDate();

		// –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–∑–≤—É –º—ñ—Å—è—Ü—è —Ç–∞ —Ä–æ–∫—É
		document.getElementById('monthYear').textContent = this.Months[m] + ' ' + y;

		var html = '<table>';
		html += '<tr class="days">';
		for (var i = 0; i < this.DaysOfWeek.length; i++) {
			html += '<td>' + this.DaysOfWeek[i] + '</td>';
		}
		html += '</tr>';

		var i = 1;
		do {
			var dow = new Date(y, m, i).getDay();
			if (dow == 1) {
				html += '<tr>';
			} else if (i == 1) {
				html += '<tr>';
				var k = lastDayOfLastMonth - firstDayOfMonth + 1;
				for (var j = 0; j < firstDayOfMonth; j++) {
					html += '<td class="not-current">' + k + '</td>';
					k++;
				}
			}

			var currentDate = new Date(y, m, i);
			var eventsForDay = this.events.filter(event => {
				var eventDate = new Date(event.date);
				return eventDate.getFullYear() === y &&
					   eventDate.getMonth() === m &&
					   eventDate.getDate() === i;
			});

			var hasEvent = eventsForDay.length > 0;
			var isPastEvent = false;
			if (hasEvent) {
				const now = new Date();
				isPastEvent = eventsForDay.every(event => {
					const eventDate = new Date(event.date);
					return eventDate < now;
				});
			}

			var chk = new Date();
			var chkY = chk.getFullYear();
			var chkM = chk.getMonth();
			if (chkY == this.currYear && chkM == this.currMonth && i == this.currDay) {
				html += `<td class="today${hasEvent ? (isPastEvent ? ' past-event-day' : ' event-day') : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
			} else {
				html += `<td class="normal${hasEvent ? (isPastEvent ? ' past-event-day' : ' event-day') : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
			}

			if (dow == 0) {
				html += '</tr>';
			} else if (i == lastDateOfMonth) {
				var k = 1;
				for (dow; dow < 7; dow++) {
					html += '<td class="not-current">' + k + '</td>';
					k++;
				}
			}
			i++;
		} while (i <= lastDateOfMonth);

		html += '</table>';
		document.getElementById(this.divId).innerHTML = html;
	};

	Cal.prototype.showDayEvents = function(year, month, day) {
		const selectedDate = new Date(year, month, day);
		const dayOfWeek = this.DaysOfWeek[selectedDate.getDay() === 0 ? 6 : selectedDate.getDay() - 1];
		const dateStr = `${day} ${this.Months[month].toUpperCase()} ${year} - ${dayOfWeek}`;
		document.getElementById('selectedDate').textContent = dateStr;

		const eventsOnDay = this.events.filter(event => {
			const eventDate = new Date(event.date);
			return eventDate.getFullYear() === year &&
				   eventDate.getMonth() === month &&
				   eventDate.getDate() === day;
		});

		const eventContainer = document.getElementById('eventDetails');
		eventContainer.innerHTML = '';

		if (eventsOnDay.length > 0) {
			eventsOnDay.forEach(event => {
				const eventDate = new Date(event.date);
				const timeStr = eventDate.toTimeString().slice(0, 5);
				const eventHtml = `
					<div>
						<h2 class="event-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'}</h2>
						<p class="event-desc">–ß–∞—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è: ${timeStr}</p>
					</div>
				`;
				eventContainer.innerHTML += eventHtml;
			});
		} else {
			eventContainer.innerHTML = `
				<p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∏—Ö –ø–æ–¥—ñ–π</p>
			`;
		}

		try {
			$.arcticmodal({
				content: '#exampleModal-3'
			});
		} catch (error) {
			console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-3):', error);
			alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
		}
	};

	Cal.prototype.showAllEvents = function() {
		document.getElementById('currentMonth').textContent = 
			this.Months[this.currMonth] + ' ' + this.currYear;

		const eventList = document.getElementById('eventList');
		eventList.innerHTML = '';

		const daysInMonth = new Date(this.currYear, this.currMonth + 1, 0).getDate();

		for (let day = 1; day <= daysInMonth; day++) {
			const eventsForDay = this.events.filter(event => {
				const eventDate = new Date(event.date);
				return eventDate.getFullYear() === this.currYear &&
					   eventDate.getMonth() === this.currMonth &&
					   eventDate.getDate() === day;
			});

			const li = document.createElement('li');
			li.classList.add('event-item');
			if (eventsForDay.length > 0) {
				li.classList.add('activ-event-day');
				const now = new Date();
				const isPastEvent = eventsForDay.every(event => {
					const eventDate = new Date(event.date);
					return eventDate < now;
				});
				li.classList.add(isPastEvent ? 'past' : 'future');
				eventsForDay.forEach(event => {
					const eventDate = new Date(event.date);
					const hours = String(eventDate.getHours()).padStart(2, '0');
					const minutes = String(eventDate.getMinutes()).padStart(2, '0');
					const time = `${hours}:${minutes}`;
					const eventLi = document.createElement('div');
					eventLi.classList.add('event-subitem');
					eventLi.innerHTML = `
						<p>${day} - ${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'} (${time})</p>
					`;
					li.appendChild(eventLi);
				});
			} else {
				li.classList.add('event-absent');
				li.innerHTML = `<p>${day}</p><p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∞ –ø–æ–¥—ñ—è</p>`;
			}
			eventList.appendChild(li);
		}

		try {
			$.arcticmodal({
				content: '#exampleModal-5'
			});
		} catch (error) {
			console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-5):', error);
			alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
		}
	};

	// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
	const calendarInstance = new Cal('divCal');

	// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ–¥—ñ—ó —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∫–∞–ª–µ–Ω–¥–∞—Ä
	calendarInstance.fetchEvents().then(() => {
		calendarInstance.showcurr();
	});

	// –ü—Ä–∏–≤‚Äô—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–æ –∫–Ω–æ–ø–æ–∫
	document.getElementById('btnPrev').addEventListener('click', () => calendarInstance.previousMonth());
	document.getElementById('btnNext').addEventListener('click', () => calendarInstance.nextMonth());
	document.querySelector('.podii-2').addEventListener('click', (e) => {
		e.preventDefault();
		calendarInstance.showAllEvents();
	});

	// –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω
	document.querySelector('.task-for-one').addEventListener('click', (e) => {
		e.preventDefault();
		flatpickr("#exampleModal-6 .namb-input", {
			enableTime: false,
			dateFormat: "Y-m-d",
			defaultDate: new Date(),
			locale: { firstDayOfWeek: 1 }
		});
		$.arcticmodal({
			content: '#exampleModal-6'
		});
	});

	document.querySelector('.task-for-group').addEventListener('click', (e) => {
		e.preventDefault();
		flatpickr("#exampleModal-7 .namb-input", {
			enableTime: false,
			dateFormat: "Y-m-d",
			defaultDate: new Date(),
			locale: { firstDayOfWeek: 1 }
		});
		$.arcticmodal({
			content: '#exampleModal-7'
		});
	});

	document.querySelector('.assessment').addEventListener('click', (e) => {
		e.preventDefault();
		$.arcticmodal({
			content: '#exampleModal-8'
		});
	});

	document.querySelector('.remove-student').addEventListener('click', (e) => {
		e.preventDefault();
		$.arcticmodal({
			content: '#exampleModal-9'
		});
	});

	document.querySelector('.general-event').addEventListener('click', (e) => {
		e.preventDefault();
		showEventForm();
	});

	function showEventForm() {
		document.getElementById('formTitle').textContent = '–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é';
		document.getElementById('formTitle').dataset.mode = 'add';
		document.getElementById('eventId').value = '';
		document.getElementById('eventTitle').value = '';

		flatpickr("#eventDate", {
			enableTime: true,
			dateFormat: "Y-m-d H:i",
			defaultDate: new Date(),
			time_24hr: true,
			minuteIncrement: 1,
			locale: { firstDayOfWeek: 1 }
		});

		$.arcticmodal({
			content: '#exampleModal-10'
		});
	}

	async function saveEvent(event) {
		event.preventDefault();
		const eventId = document.getElementById('eventId').value;
		const title = document.getElementById('eventTitle').value;
		const date = document.getElementById('eventDate').value;

		if (!title || !date) {
			alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (–Ω–∞–∑–≤–∞ —ñ –¥–∞—Ç–∞)');
			return;
		}

		const eventDate = new Date(date);
		const year = eventDate.getFullYear();
		const month = String(eventDate.getMonth() + 1).padStart(2, '0');
		const day = String(eventDate.getDate()).padStart(2, '0');
		const hours = String(eventDate.getHours()).padStart(2, '0');
		const minutes = String(eventDate.getMinutes()).padStart(2, '0');
		const seconds = String(eventDate.getSeconds()).padStart(2, '0');
		const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

		const eventData = {
			title: title,
			date: formattedDate
		};

		try {
			let response;
			if (eventId) {
				response = await fetch(`/api/events/${eventId}`, {
					method: 'PUT',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(eventData)
				});
			} else {
				response = await fetch('/api/events', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(eventData)
				});
			}

			if (response.ok) {
				await calendarInstance.fetchEvents();
				calendarInstance.showcurr();
				$.arcticmodal('close');
			} else {
				alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
			}
		} catch (error) {
			console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–ø–∏—Ç—É:', error);
			alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
		}
	}
</script>
{% endblock %}
