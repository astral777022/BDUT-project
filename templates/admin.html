{% extends "base.html" %}

{% block title %}
    —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <header class="header" id="header">
        <div class="container">
            <div class="row d-flex align-items-center">
                <div class="col-3 col-md-4 col-lg-2">
                    <a href="index.html">
                        <img class="img-fluid logo" src="{{url_for('static', filename='img/low.png')}}" alt="logo">
                    </a>
                </div>
                <div class="col-9 serh d-lg-flex col-md-8 col-lg-7 flex items-center">
                    <div class="search-wrapper">
                        <input type="text" placeholder="–ü–æ—à—É–∫..." class="search-input" />
                        <button class="search-button">üîç</button>
                    </div>
                </div>
                <div class="col-12 reg-in col-md-12 d-lg-flex col-lg-3 justify-content-end align-items-center menu-collapse">
                    <nav class="menu">
                        <ul class="menu__list d-flex">
                            <li class="menu__item">
                                <p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="container mt-4">
        <!-- –î–æ–¥–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
        <div id="notification" class="notification" style="display: none;"></div>
        <div class="row">
            <!-- Button Column -->
            <div class="col-12 col-md-4 mb-4">
                <div class="button-column">
                    <button class="admin-button add-admin">–î–æ–¥–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
                    <button class="admin-button delete-admin">–í–∏–¥–∞–ª–∏—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
                    <button class="admin-button add-teacher">–î–æ–¥–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è</button>
                    <button class="admin-button delete-teacher">–í–∏–¥–∞–ª–∏—Ç–∏ –≤—á–∏—Ç–µ–ª—è</button>
                    <button class="admin-button view-rights">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–∞–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
                </div>
            </div>

            <!-- Calendar Section -->
            <div class="col-12 col-md-8">
                <section class="cal-2">
                    <div class="calendar-wrapper">
                        <div class="calendar-header">
                            <button id="btnPrev" type="button">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π</button>
                            <span id="monthYear"></span>
                            <button id="btnNext" type="button">–ù–∞—Å—Ç—É–ø–Ω–∏–π</button>
                        </div>
                        <div id="divCal" class="calendar-table"></div>
                        <div class="calendar-buttons">
                            <a href="#" class="podii-2">–í—Å—ñ –ø–æ–¥—ñ—ó —Ü—å–æ–≥–æ –º—ñ—Å—è—Ü—è</a>
                            <a href="#" class="admin-general-event">–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é</a>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-3">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <div>
                <div class="date">
                    <p>–°—é–¥–∏ –ø–æ–≤–∏–Ω–Ω–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ –ø–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞</p>
                </div>
                <div class="desc-date">
                    <p>–ü–æ–¥—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
                </div>
            </div>
        </div>
    </div>

    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-5">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <div class="date">
                <p id="currentMonth"></p>
            </div>
            <ul class="admin-list-event" id="eventList"></ul>
        </div>
    </div>

    <!-- Modal for Adding Event -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-10">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 id="formTitle" style="text-align: center;">–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é</h2>
            <div class="form">
                <input type="hidden" id="eventId">
                <div class="input-box">
                    <label>–ù–∞–∑–≤–∞ –ø–æ–¥—ñ—ó</label>
                    <input type="text" id="eventTitle" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø–æ–¥—ñ—ó">
                </div>
                <div class="input-box">
                    <label>–î–∞—Ç–∞ —ñ —á–∞—Å</label>
                    <input type="text" id="eventDate" placeholder="–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —ñ —á–∞—Å">
                </div>
                <div class="admin-form-button">
                    <button onclick="saveEvent(event)">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Admin -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-add-admin">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 style="text-align: center;">–î–æ–¥–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <div class="form">
                <div class="input-box">
                    <label>–õ–æ–≥—ñ–Ω</label>
                    <input type="text" id="adminLogin" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω">
                </div>
                <div class="input-box">
                    <label>–Ü–º'—è</label>
                    <input type="text" id="adminFirstName" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è">
                </div>
                <div class="input-box">
                    <label>–ü—Ä—ñ–∑–≤–∏—â–µ</label>
                    <input type="text" id="adminLastName" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ">
                </div>
                <div class="input-box">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="adminPassword" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                </div>
                <div class="admin-form-button">
                    <button onclick="saveAdmin(event)">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Deleting Admin -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-delete-admin">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 style="text-align: center;">–í–∏–¥–∞–ª–∏—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
            <div class="form">
                <div class="input-box">
                    <label>–Ü–º'—è</label>
                    <input type="text" id="deleteAdminFirstName" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è" oninput="checkAdmin()">
                </div>
                <div class="input-box">
                    <label>–ü—Ä—ñ–∑–≤–∏—â–µ</label>
                    <input type="text" id="deleteAdminLastName" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ" oninput="checkAdmin()">
                </div>
                <!-- –ï–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π -->
                <div id="adminSuggestions" style="margin-top: 10px; color: #555;"></div>
                <div class="admin-form-button">
                    <button id="deleteAdminButton" onclick="deleteAdmin(event)" disabled>–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Adding Teacher -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-add-teacher">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 style="text-align: center;">–î–æ–¥–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è</h2>
            <div class="form">
                <div class="input-box">
                    <label>–õ–æ–≥—ñ–Ω</label>
                    <input type="text" id="teacherLogin" placeholder="–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω">
                </div>
                <div class="input-box">
                    <label>–Ü–º'—è</label>
                    <input type="text" id="teacherFirstName" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è">
                </div>
                <div class="input-box">
                    <label>–ü—Ä—ñ–∑–≤–∏—â–µ</label>
                    <input type="text" id="teacherLastName" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ">
                </div>
                <div class="input-box">
                    <label>–ö–ª–∞—Å</label>
                    <select id="teacherClass" name="teacherClass">
                        <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –∫–ª–∞—Å</option>
                        <option value="–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∏–π –∫–ª–∞—Å">–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∏–π –∫–ª–∞—Å</option>
                        <option value="–¢–∞–Ω—Ü—é–≤–∞–ª—å–Ω–∏–π –∫–ª–∞—Å">–¢–∞–Ω—Ü—é–≤–∞–ª—å–Ω–∏–π –∫–ª–∞—Å</option>
                        <option value="–ö—É–ª—ñ–Ω–∞—Ä—ñ—è">–ö—É–ª—ñ–Ω–∞—Ä—ñ—è</option>
                        <option value="–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ –º–æ–≤–∞">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ –º–æ–≤–∞</option>
                    </select>
                </div>
                <div class="input-box">
                    <label>–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="teacherPassword" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                </div>
                <div class="admin-form-button">
                    <button onclick="saveTeacher(event)">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Deleting Teacher -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-delete-teacher">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 style="text-align: center;">–í–∏–¥–∞–ª–∏—Ç–∏ –≤—á–∏—Ç–µ–ª—è</h2>
            <div class="form">
                <div class="input-box">
                    <label>–Ü–º'—è</label>
                    <input type="text" id="deleteTeacherFirstName" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è" oninput="checkTeacher()">
                </div>
                <div class="input-box">
                    <label>–ü—Ä—ñ–∑–≤–∏—â–µ</label>
                    <input type="text" id="deleteTeacherLastName" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ" oninput="checkTeacher()">
                </div>
                <!-- –ï–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ–π -->
                <div id="teacherSuggestions" style="margin-top: 10px; color: #555;"></div>
                <div class="admin-form-button">
                    <button id="deleteTeacherButton" onclick="deleteTeacher(event)" disabled>–í–∏–¥–∞–ª–∏—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing User Rights -->
    <div style="display: none;">
        <div class="admin-box-modal" id="exampleModal-view-rights">
            <div class="admin-box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 style="text-align: center;">–ü—Ä–∞–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
            <div class="user-rights-list" style="margin-top: 20px;">
                <ul id="userRightsList" style="list-style-type: none; padding: 0;"></ul>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var Cal = function(divId) {
    this.divId = divId;
    this.DaysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥'];
    this.Months = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
    var d = new Date();
    this.currMonth = d.getMonth();
    this.currYear = d.getFullYear();
    this.currDay = d.getDate();
    this.events = [];
};

Cal.prototype.fetchEvents = async function() {
    try {
        const response = await fetch('/api/events', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        this.events = await response.json();
        console.log('–ü–æ–¥—ñ—ó –∑ API:', this.events);
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø–æ–¥—ñ–π:', error);
    }
};

Cal.prototype.nextMonth = function() {
    if (this.currMonth == 11) {
        this.currMonth = 0;
        this.currYear = this.currYear + 1;
    } else {
        this.currMonth = this.currMonth + 1;
    }
    this.showcurr();
};

Cal.prototype.previousMonth = function() {
    if (this.currMonth == 0) {
        this.currMonth = 11;
        this.currYear = this.currYear - 1;
    } else {
        this.currMonth = this.currMonth - 1;
    }
    this.showcurr();
};

Cal.prototype.showcurr = function() {
    this.showMonth(this.currYear, this.currMonth);
};

Cal.prototype.showMonth = function(y, m) {
    var d = new Date();
    var firstDayOfMonth = new Date(y, m, 7).getDay();
    var lastDateOfMonth = new Date(y, m + 1, 0).getDate();
    var lastDayOfLastMonth = m == 0 ? new Date(y - 1, 11, 0).getDate() : new Date(y, m, 0).getDate();

    // –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–∑–≤—É –º—ñ—Å—è—Ü—è —Ç–∞ —Ä–æ–∫—É
    document.getElementById('monthYear').textContent = this.Months[m] + ' ' + y;

    var html = '<table>';
    html += '<tr class="days">';
    for (var i = 0; i < this.DaysOfWeek.length; i++) {
        html += '<td>' + this.DaysOfWeek[i] + '</td>';
    }
    html += '</tr>';

    var i = 1;
    do {
        var dow = new Date(y, m, i).getDay();
        if (dow == 1) {
            html += '<tr>';
        } else if (i == 1) {
            html += '<tr>';
            var k = lastDayOfLastMonth - firstDayOfMonth + 1;
            for (var j = 0; j < firstDayOfMonth; j++) {
                html += '<td class="not-current">' + k + '</td>';
                k++;
            }
        }

        var currentDate = new Date(y, m, i);
        var eventsForDay = this.events.filter(event => {
            var eventDate = new Date(event.date);
            return eventDate.getFullYear() === y &&
                   eventDate.getMonth() === m &&
                   eventDate.getDate() === i;
        });

        var hasEvent = eventsForDay.length > 0;
        var isPastEvent = false;
        if (hasEvent) {
            const now = new Date();
            isPastEvent = eventsForDay.every(event => {
                const eventDate = new Date(event.date);
                return eventDate < now;
            });
        }

        var chk = new Date();
        var chkY = chk.getFullYear();
        var chkM = chk.getMonth();
        if (chkY == this.currYear && chkM == this.currMonth && i == this.currDay) {
            html += `<td class="today${hasEvent ? (isPastEvent ? ' past-event-day' : ' event-day') : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
        } else {
            html += `<td class="normal${hasEvent ? (isPastEvent ? ' past-event-day' : ' event-day') : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
        }

        if (dow == 0) {
            html += '</tr>';
        } else if (i == lastDateOfMonth) {
            var k = 1;
            for (dow; dow < 7; dow++) {
                html += '<td class="not-current">' + k + '</td>';
                k++;
            }
        }
        i++;
    } while (i <= lastDateOfMonth);

    html += '</table>';
    document.getElementById(this.divId).innerHTML = html;
};

Cal.prototype.showDayEvents = function(year, month, day) {
    const selectedDate = new Date(year, month, day);
    const dayOfWeek = this.DaysOfWeek[selectedDate.getDay() === 0 ? 6 : selectedDate.getDay() - 1];
    const dateStr = `${day} ${this.Months[month].toUpperCase()} ${year} - ${dayOfWeek}`;
    document.querySelector('#exampleModal-3 .date p').textContent = dateStr;

    const eventsOnDay = this.events.filter(event => {
        const eventDate = new Date(event.date);
        return eventDate.getFullYear() === year &&
               eventDate.getMonth() === month &&
               eventDate.getDate() === day;
    });

    const eventContainer = document.querySelector('#exampleModal-3 .desc-date');
    eventContainer.innerHTML = '';

    if (eventsOnDay.length > 0) {
        eventsOnDay.forEach(event => {
            const eventDate = new Date(event.date);
            const timeStr = eventDate.toTimeString().slice(0, 5);
            const eventHtml = `
                <div>
                    <h2 class="event-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'}</h2>
                    <p class="event-desc">–ß–∞—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è: ${timeStr}</p>
                </div>
            `;
            eventContainer.innerHTML += eventHtml;
        });
    } else {
        eventContainer.innerHTML = `
            <p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∏—Ö –ø–æ–¥—ñ–π</p>
        `;
    }

    try {
        $.arcticmodal({
            content: '#exampleModal-3'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-3):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
};

Cal.prototype.showAllEvents = function() {
    document.getElementById('currentMonth').textContent = 
        this.Months[this.currMonth] + ' ' + this.currYear;

    const eventList = document.getElementById('eventList');
    eventList.innerHTML = '';

    const daysInMonth = new Date(this.currYear, this.currMonth + 1, 0).getDate();

    for (let day = 1; day <= daysInMonth; day++) {
        const eventsForDay = this.events.filter(event => {
            const eventDate = new Date(event.date);
            return eventDate.getFullYear() === this.currYear &&
                   eventDate.getMonth() === this.currMonth &&
                   eventDate.getDate() === day;
        });

        const li = document.createElement('li');
        li.classList.add('event-item');
        if (eventsForDay.length > 0) {
            li.classList.add('event-present');
            const now = new Date();
            const isPastEvent = eventsForDay.every(event => {
                const eventDate = new Date(event.date);
                return eventDate < now;
            });
            li.classList.add(isPastEvent ? 'past' : 'future');
            eventsForDay.forEach(event => {
                const eventDate = new Date(event.date);
                const hours = String(eventDate.getHours()).padStart(2, '0');
                const minutes = String(eventDate.getMinutes()).padStart(2, '0');
                const time = `${hours}:${minutes}`;
                const eventLi = document.createElement('div');
                eventLi.classList.add('event-subitem');
                eventLi.innerHTML = `
                    <p>${day} - ${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'} (${time})</p>
                    <button class="delete-btn" onclick="deleteEvent('${event.id}')">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                `;
                li.appendChild(eventLi);
            });
        } else {
            li.classList.add('event-absent');
            li.innerHTML = `<p>${day}</p><p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∞ –ø–æ–¥—ñ—è</p>`;
        }
        eventList.appendChild(li);
    }

    try {
        $.arcticmodal({
            content: '#exampleModal-5'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-5):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
};

function showEventForm() {
    document.getElementById('formTitle').textContent = '–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é';
    document.getElementById('formTitle').dataset.mode = 'add';
    document.getElementById('eventId').value = '';
    document.getElementById('eventTitle').value = '';

    flatpickr("#eventDate", {
        enableTime: true,
        dateFormat: "Y-m-d H:i",
        defaultDate: new Date(),
        time_24hr: true,
        minuteIncrement: 1,
        locale: { firstDayOfWeek: 1 }
    });

    try {
        $.arcticmodal({
            content: '#exampleModal-10'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-10):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
}

function showAddAdminForm() {
    // –°–∫–∏–¥–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏
    document.getElementById('adminLogin').value = '';
    document.getElementById('adminFirstName').value = '';
    document.getElementById('adminLastName').value = '';
    document.getElementById('adminPassword').value = '';

    try {
        $.arcticmodal({
            content: '#exampleModal-add-admin'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-add-admin):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
}

function showDeleteAdminForm() {
    // –°–∫–∏–¥–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏
    document.getElementById('deleteAdminFirstName').value = '';
    document.getElementById('deleteAdminLastName').value = '';
    document.getElementById('deleteAdminButton').disabled = true;

    // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∏–ª—ñ –ø–æ–ª—ñ–≤
    const firstNameInput = document.getElementById('deleteAdminFirstName');
    const lastNameInput = document.getElementById('deleteAdminLastName');
    firstNameInput.style.backgroundColor = '';
    lastNameInput.style.backgroundColor = '';

    // –û—á–∏—â–∞—î–º–æ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
    document.getElementById('adminSuggestions').innerHTML = '';

    try {
        $.arcticmodal({
            content: '#exampleModal-delete-admin'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-delete-admin):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
}

function showAddTeacherForm() {
    // –°–∫–∏–¥–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏
    document.getElementById('teacherLogin').value = '';
    document.getElementById('teacherFirstName').value = '';
    document.getElementById('teacherLastName').value = '';
    document.getElementById('teacherClass').value = '';
    document.getElementById('teacherPassword').value = '';

    try {
        $.arcticmodal({
            content: '#exampleModal-add-teacher'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-add-teacher):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
}

function showDeleteTeacherForm() {
    // –°–∫–∏–¥–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏
    document.getElementById('deleteTeacherFirstName').value = '';
    document.getElementById('deleteTeacherLastName').value = '';
    document.getElementById('deleteTeacherButton').disabled = true;

    // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∏–ª—ñ –ø–æ–ª—ñ–≤
    const firstNameInput = document.getElementById('deleteTeacherFirstName');
    const lastNameInput = document.getElementById('deleteTeacherLastName');
    firstNameInput.style.backgroundColor = '';
    lastNameInput.style.backgroundColor = '';

    // –û—á–∏—â–∞—î–º–æ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
    document.getElementById('teacherSuggestions').innerHTML = '';

    try {
        $.arcticmodal({
            content: '#exampleModal-delete-teacher'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ (#exampleModal-delete-teacher):', error);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
    }
}

async function showUserRights() {
    try {
        // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
        const userRightsList = document.getElementById('userRightsList');
        userRightsList.innerHTML = '';

        // –û—Ç—Ä–∏–º—É—î–º–æ –≤—á–∏—Ç–µ–ª—ñ–≤
        const teachersResponse = await fetch('/api/teachers', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!teachersResponse.ok) {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —Å–ø–∏—Å–∫—É –≤—á–∏—Ç–µ–ª—ñ–≤');
        }

        const teachers = await teachersResponse.json();

        // –û—Ç—Ä–∏–º—É—î–º–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
        const adminsResponse = await fetch('/api/admins', {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!adminsResponse.ok) {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —Å–ø–∏—Å–∫—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤');
        }

        const admins = await adminsResponse.json();

        // –û–±'—î–¥–Ω—É—î–º–æ —Å–ø–∏—Å–∫–∏
        const allUsers = [...teachers, ...admins];

        if (allUsers.length === 0) {
            userRightsList.innerHTML = '<li>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ</li>';
        } else {
            allUsers.forEach(user => {
                const li = document.createElement('li');
                li.style.padding = '5px 0';
                li.textContent = `${user.firstName} ${user.lastName} - ${user.role}`;
                userRightsList.appendChild(li);
            });
        }

        // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        $.arcticmodal({
            content: '#exampleModal-view-rights'
        });
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø—Ä–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:', error);
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø—Ä–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤';
            notification.style.background = '#dc3545';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.background = '#28a745';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    }
}

async function checkAdmin() {
    const firstName = document.getElementById('deleteAdminFirstName').value.trim();
    const lastName = document.getElementById('deleteAdminLastName').value.trim();
    const firstNameInput = document.getElementById('deleteAdminFirstName');
    const lastNameInput = document.getElementById('deleteAdminLastName');
    const deleteButton = document.getElementById('deleteAdminButton');
    const suggestionsDiv = document.getElementById('adminSuggestions');

    // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Å—Ç–∏–ª—ñ —Ç–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
    firstNameInput.style.backgroundColor = '';
    lastNameInput.style.backgroundColor = '';
    deleteButton.disabled = true;
    suggestionsDiv.innerHTML = '';

    if (!firstName || !lastName) {
        return;
    }

    try {
        const response = await fetch('/api/admins/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName: firstName, lastName: lastName })
        });

        const result = await response.json();

        if (response.ok && result.found) {
            // –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–Ω–∞–π–¥–µ–Ω–∏–π, —Ñ–∞—Ä–±—É—î–º–æ –ø–æ–ª—è –≤ –∑–µ–ª–µ–Ω–∏–π
            firstNameInput.style.backgroundColor = '#d4edda';
            lastNameInput.style.backgroundColor = '#d4edda';
            deleteButton.disabled = false;
        } else {
            // –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π, —Ñ–∞—Ä–±—É—î–º–æ –ø–æ–ª—è –≤ —á–µ—Ä–≤–æ–Ω–∏–π
            firstNameInput.style.backgroundColor = '#f8d7da';
            lastNameInput.style.backgroundColor = '#f8d7da';
            deleteButton.disabled = true;

            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó, —è–∫—â–æ –≤–æ–Ω–∏ —î
            if (result.suggestions && result.suggestions.length > 0) {
                let suggestionsHtml = '<p>–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –º–∞–ª–∏ –Ω–∞ —É–≤–∞–∑—ñ:</p><ul>';
                result.suggestions.forEach(suggestion => {
                    suggestionsHtml += `<li style="cursor: pointer; color: #007bff;" onclick="fillAdminFields('${suggestion.firstName}', '${suggestion.lastName}')">${suggestion.firstName} ${suggestion.lastName}</li>`;
                });
                suggestionsHtml += '</ul>';
                suggestionsDiv.innerHTML = suggestionsHtml;
            }
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', error);
        firstNameInput.style.backgroundColor = '#f8d7da';
        lastNameInput.style.backgroundColor = '#f8d7da';
        deleteButton.disabled = true;
    }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
function fillAdminFields(firstName, lastName) {
    document.getElementById('deleteAdminFirstName').value = firstName;
    document.getElementById('deleteAdminLastName').value = lastName;
    checkAdmin(); // –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ
}

async function deleteAdmin(event) {
    event.preventDefault();

    const firstName = document.getElementById('deleteAdminFirstName').value.trim();
    const lastName = document.getElementById('deleteAdminLastName').value.trim();

    try {
        const response = await fetch('/api/admins/delete', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName: firstName, lastName: lastName })
        });

        if (response.ok) {
            // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
            $.arcticmodal('close');

            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π';
                notification.style.display = 'block';
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 300);
                }, 3000);
            } else {
                console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
            }
        } else {
            const errorData = await response.json();
            throw new Error(errorData.error || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:', error);

        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = error.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
            notification.style.background = '#dc3545';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.background = '#28a745';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    }
}

async function saveAdmin(event) {
    event.preventDefault();
    
    const login = document.getElementById('adminLogin').value.trim();
    const firstName = document.getElementById('adminFirstName').value.trim();
    const lastName = document.getElementById('adminLastName').value.trim();
    const password = document.getElementById('adminPassword').value.trim();

    if (!login || !firstName || !lastName || !password) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (–ª–æ–≥—ñ–Ω, —ñ–º‚Äô—è, –ø—Ä—ñ–∑–≤–∏—â–µ, –ø–∞—Ä–æ–ª—å)');
        return;
    }

    const adminData = {
        login: login,
        firstName: firstName,
        lastName: lastName,
        password: password
    };

    try {
        const response = await fetch('/api/admins', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(adminData)
        });

        if (response.ok) {
            $.arcticmodal('close');

            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = '–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–∏–π';
                notification.style.display = 'block';
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 300);
                }, 3000);
            } else {
                console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
            }
        } else {
            const errorData = await response.json();
            throw new Error(errorData.error || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–ø–∏—Ç—É:', error);
        
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = error.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞';
            notification.style.background = '#dc3545';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.background = '#28a745';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    }
}

async function checkTeacher() {
    const firstName = document.getElementById('deleteTeacherFirstName').value.trim();
    const lastName = document.getElementById('deleteTeacherLastName').value.trim();
    const firstNameInput = document.getElementById('deleteTeacherFirstName');
    const lastNameInput = document.getElementById('deleteTeacherLastName');
    const deleteButton = document.getElementById('deleteTeacherButton');
    const suggestionsDiv = document.getElementById('teacherSuggestions');

    // –û—á–∏—â–∞—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Å—Ç–∏–ª—ñ —Ç–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó
    firstNameInput.style.backgroundColor = '';
    lastNameInput.style.backgroundColor = '';
    deleteButton.disabled = true;
    suggestionsDiv.innerHTML = '';

    if (!firstName || !lastName) {
        return;
    }

    try {
        const response = await fetch('/api/teachers/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName: firstName, lastName: lastName })
        });

        const result = await response.json();

        if (response.ok && result.found) {
            // –í—á–∏—Ç–µ–ª—å –∑–Ω–∞–π–¥–µ–Ω–∏–π, —Ñ–∞—Ä–±—É—î–º–æ –ø–æ–ª—è –≤ –∑–µ–ª–µ–Ω–∏–π
            firstNameInput.style.backgroundColor = '#d4edda';
            lastNameInput.style.backgroundColor = '#d4edda';
            deleteButton.disabled = false;
        } else {
            // –í—á–∏—Ç–µ–ª—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π, —Ñ–∞—Ä–±—É—î–º–æ –ø–æ–ª—è –≤ —á–µ—Ä–≤–æ–Ω–∏–π
            firstNameInput.style.backgroundColor = '#f8d7da';
            lastNameInput.style.backgroundColor = '#f8d7da';
            deleteButton.disabled = true;

            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó, —è–∫—â–æ –≤–æ–Ω–∏ —î
            if (result.suggestions && result.suggestions.length > 0) {
                let suggestionsHtml = '<p>–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –º–∞–ª–∏ –Ω–∞ —É–≤–∞–∑—ñ:</p><ul>';
                result.suggestions.forEach(suggestion => {
                    suggestionsHtml += `<li style="cursor: pointer; color: #007bff;" onclick="fillTeacherFields('${suggestion.firstName}', '${suggestion.lastName}')">${suggestion.firstName} ${suggestion.lastName}</li>`;
                });
                suggestionsHtml += '</ul>';
                suggestionsDiv.innerHTML = suggestionsHtml;
            }
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ –≤—á–∏—Ç–µ–ª—è:', error);
        firstNameInput.style.backgroundColor = '#f8d7da';
        lastNameInput.style.backgroundColor = '#f8d7da';
        deleteButton.disabled = true;
    }
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ–ª—ñ–≤ –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó –¥–ª—è –≤—á–∏—Ç–µ–ª—è
function fillTeacherFields(firstName, lastName) {
    document.getElementById('deleteTeacherFirstName').value = firstName;
    document.getElementById('deleteTeacherLastName').value = lastName;
    checkTeacher(); // –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ
}

async function deleteTeacher(event) {
    event.preventDefault();

    const firstName = document.getElementById('deleteTeacherFirstName').value.trim();
    const lastName = document.getElementById('deleteTeacherLastName').value.trim();

    try {
        const response = await fetch('/api/teachers/delete', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName: firstName, lastName: lastName })
        });

        if (response.ok) {
            // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
            $.arcticmodal('close');

            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = '–í—á–∏—Ç–µ–ª—å —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∏–π';
                notification.style.display = 'block';
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 300);
                }, 3000);
            } else {
                console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
            }
        } else {
            const errorData = await response.json();
            throw new Error(errorData.error || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –≤—á–∏—Ç–µ–ª—è');
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –≤—á–∏—Ç–µ–ª—è:', error);

        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = error.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –≤—á–∏—Ç–µ–ª—è';
            notification.style.background = '#dc3545';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.background = '#28a745';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    }
}

async function saveEvent(event) {
    event.preventDefault();
    const eventId = document.getElementById('eventId').value;
    const title = document.getElementById('eventTitle').value;
    const date = document.getElementById('eventDate').value;

    if (!title || !date) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (–Ω–∞–∑–≤–∞ —ñ –¥–∞—Ç–∞)');
        return;
    }

    const eventDate = new Date(date);
    const year = eventDate.getFullYear();
    const month = String(eventDate.getMonth() + 1).padStart(2, '0');
    const day = String(eventDate.getDate()).padStart(2, '0');
    const hours = String(eventDate.getHours()).padStart(2, '0');
    const minutes = String(eventDate.getMinutes()).padStart(2, '0');
    const seconds = String(eventDate.getSeconds()).padStart(2, '0');
    const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

    const eventData = {
        title: title,
        date: formattedDate
    };

    try {
        let response;
        if (eventId) {
            response = await fetch(`/api/events/${eventId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(eventData)
            });
        } else {
            response = await fetch('/api/events', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(eventData)
            });
        }

        if (response.ok) {
            await calendarInstance.fetchEvents();
            calendarInstance.showcurr();
            $.arcticmodal('close');
        } else {
            alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–ø–∏—Ç—É:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
    }
}

async function saveTeacher(event) {
    event.preventDefault();
    
    const login = document.getElementById('teacherLogin').value.trim();
    const firstName = document.getElementById('teacherFirstName').value.trim();
    const lastName = document.getElementById('teacherLastName').value.trim();
    const teacherClass = document.getElementById('teacherClass').value;
    const password = document.getElementById('teacherPassword').value.trim();

    if (!login || !firstName || !lastName || !teacherClass || !password) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (–ª–æ–≥—ñ–Ω, —ñ–º‚Äô—è, –ø—Ä—ñ–∑–≤–∏—â–µ, –∫–ª–∞—Å, –ø–∞—Ä–æ–ª—å)');
        return;
    }

    const teacherData = {
        login: login,
        firstName: firstName,
        lastName: lastName,
        class: teacherClass,
        password: password
    };

    try {
        const response = await fetch('/api/teachers', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(teacherData)
        });

        if (response.ok) {
            $.arcticmodal('close');

            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = '–í—á–∏—Ç–µ–ª—å —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–∏–π';
                notification.style.display = 'block';
                notification.classList.add('show');

                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, 300);
                }, 3000);
            } else {
                console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
            }
        } else {
            const errorData = await response.json();
            throw new Error(errorData.error || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –≤—á–∏—Ç–µ–ª—è');
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–ø–∏—Ç—É:', error);
        
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = error.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –≤—á–∏—Ç–µ–ª—è';
            notification.style.background = '#dc3545';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.background = '#28a745';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    }
}

async function deleteEvent(eventId) {
    try {
        const response = await fetch(`/api/events/${eventId}`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) {
            throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
        }

        await calendarInstance.fetchEvents();
        calendarInstance.showcurr();
        $.arcticmodal('close');

        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = '–ü–æ–¥—ñ—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó:', error);
        const notification = document.getElementById('notification');
        if (notification) {
            notification.textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó';
            notification.style.background = '#dc3545';
            notification.style.display = 'block';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.background = '#28a745';
                }, 300);
            }, 3000);
        } else {
            console.warn('–ï–ª–µ–º–µ–Ω—Ç #notification –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∏–π —É DOM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ HTML.');
        }
    }
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
const calendarInstance = new Cal('divCal');

// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ–¥—ñ—ó —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –∫–∞–ª–µ–Ω–¥–∞—Ä
calendarInstance.fetchEvents().then(() => {
    calendarInstance.showcurr();
});

// –ü—Ä–∏–≤‚Äô—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–æ –∫–Ω–æ–ø–æ–∫
document.getElementById('btnPrev').addEventListener('click', () => calendarInstance.previousMonth());
document.getElementById('btnNext').addEventListener('click', () => calendarInstance.nextMonth());
document.querySelector('.podii-2').addEventListener('click', (e) => {
    e.preventDefault();
    calendarInstance.showAllEvents();
});
document.querySelector('.admin-general-event').addEventListener('click', (e) => {
    e.preventDefault();
    showEventForm();
});
document.querySelector('.add-admin').addEventListener('click', (e) => {
    e.preventDefault();
    showAddAdminForm();
});
document.querySelector('.delete-admin').addEventListener('click', (e) => {
    e.preventDefault();
    showDeleteAdminForm();
});
document.querySelector('.add-teacher').addEventListener('click', (e) => {
    e.preventDefault();
    showAddTeacherForm();
});
document.querySelector('.delete-teacher').addEventListener('click', (e) => {
    e.preventDefault();
    showDeleteTeacherForm();
});
document.querySelector('.view-rights').addEventListener('click', (e) => {
    e.preventDefault();
    showUserRights();
});
    </script>

<script src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/slick.min.js')}}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/parallax-bg.js')}}"></script>
<script src="{{url_for('static', filename='js/jquery.arcticmodal-0.3.min.js')}}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/jquery.validate.js')}}"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{{url_for('static', filename='js/main.js')}}"></script>
</div>
{% endblock %}
