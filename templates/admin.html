{% extends "base.html" %}

{% block title %}
    —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <header class="header" id="header">
        <div class="container">
            <div class="row d-flex align-items-center">
                <div class="col-3 col-md-4 col-lg-2">
                    <a href="index.html">
                        <img class="img-fluid logo" src="{{url_for('static', filename='img/low.png')}}" alt="logo">
                    </a>
                </div>
                <div class="col-9 serh d-lg-flex col-md-8 col-lg-7 flex items-center">
                    <div class="search-wrapper">
                        <input type="text" placeholder="–ü–æ—à—É–∫..." class="search-input" />
                        <button class="search-button">üîç</button>
                    </div>
                </div>
                <div class="col-12 reg-in col-md-12 d-lg-flex col-lg-3 justify-content-end align-items-center menu-collapse">
                    <nav class="menu">
                        <ul class="menu__list d-flex">
                            <li class="menu__item">
                                <p>–Ü–º'—è –ü—Ä–∏–∑–≤—ñ—â–µ (<span>–õ–æ–≥—ñ–Ω</span>)</p>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="container mt-4">
        <div class="row">
            <!-- Button Column -->
            <div class="col-12 col-md-4 mb-4">
                <div class="button-column">
                    <button class="admin-button add-admin">–î–æ–¥–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
                    <button class="admin-button delete-admin">–í–∏–¥–∞–ª–∏—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
                    <button class="admin-button add-teacher">–î–æ–¥–∞—Ç–∏ –≤—á–∏—Ç–µ–ª—è</button>
                    <button class="admin-button delete-teacher">–í–∏–¥–∞–ª–∏—Ç–∏ –≤—á–∏—Ç–µ–ª—è</button>
                    <button class="admin-button view-rights">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–∞–≤–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
                </div>
            </div>

            <!-- Calendar Section -->
            <div class="col-12 col-md-8">
                <section class="cal-2">
                    <div class="calendar-wrapper">
                        <div class="calendar-header">
                            <button id="btnPrev" type="button">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π</button>
                            <span id="monthYear"></span>
                            <button id="btnNext" type="button">–ù–∞—Å—Ç—É–ø–Ω–∏–π</button>
                        </div>
                        <div id="divCal" class="calendar-table"></div>
                        <div class="calendar-buttons">
                            <a href="#" class="podii-2">–í—Å—ñ –ø–æ–¥—ñ—ó —Ü—å–æ–≥–æ –º—ñ—Å—è—Ü—è</a>
                            <a href="#" class="general-event">–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é</a>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div style="display: none;">
        <div class="box-modal" id="exampleModal-3">
            <div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <div>
                <div class="date">
                    <p>–°—é–¥–∏ –ø–æ–≤–∏–Ω–Ω–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—Ç–∏ –ø–æ—Ç–æ—á–Ω–∞ –¥–∞—Ç–∞</p>
                </div>
                <div class="desc-date">
                    <p>–ü–æ–¥—ñ—ó –≤—ñ–¥—Å—É—Ç–Ω—ñ</p>
                </div>
            </div>
        </div>
    </div>

    <div style="display: none;">
        <div class="box-modal" id="exampleModal-5">
            <div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <div class="date">
                <p id="currentMonth"></p>
            </div>
            <ul class="list-event" id="eventList"></ul>
        </div>
    </div>

    <!-- Modal for Adding Event -->
    <div style="display: none;">
        <div class="box-modal" id="exampleModal-10">
            <div class="box-modal_close arcticmodal-close"><img src="{{url_for('static', filename='img/close.png')}}" class="close"></div>
            <h2 id="formTitle" style="text-align: center;">–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é</h2>
            <div class="form">
                <input type="hidden" id="eventId">
                <div class="input-box">
                    <label>–ù–∞–∑–≤–∞ –ø–æ–¥—ñ—ó</label>
                    <input type="text" id="eventTitle" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø–æ–¥—ñ—ó">
                </div>
                <div class="input-box">
                    <label>–î–∞—Ç–∞ —ñ —á–∞—Å</label>
                    <input type="text" id="eventDate" placeholder="–û–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —ñ —á–∞—Å">
                </div>
                <div class="button">
                    <button onclick="saveEvent(event)">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        .page-wrapper {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }
        .container {
            flex: 1;
        }
        .footer {
            width: 100%;
            background-color: #f8f9fa;
        }
        .button-column {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .admin-button {
            display: flex;
            justify-content: center;
            padding-top: 6px;
            width: 100%;
            max-width: 300px;
            height: 38px;
            margin-top: 24px;
            background: #e1e1e3;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            text-align: center;
            align-items: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #8b3b59;
        }
        .admin-button:hover {
            opacity: 0.9;
        }
        .calendar-wrapper {
            max-width: 400px;
            margin: 0 auto;
            padding: 10px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .calendar-header button {
            background: #e1e1e3;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .calendar-header button:hover {
            opacity: 0.9;
        }
        .calendar-header span {
            font-size: 18px;
            font-weight: bold;
        }
        .calendar-table {
            width: 100%;
            overflow-x: auto;
        }
        .calendar-table table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }
        .calendar-table td {
            padding: 8px;
            border: 1px solid #ddd;
        }
        .calendar-table .days td {
            background: #f0f0f0;
            font-weight: bold;
        }
        .calendar-table .today {
            background: #d3d3d3;
        }
        .calendar-table .event-day {
            background: #ccffcc; /* –ó–µ–ª–µ–Ω–∏–π –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –ø–æ–¥—ñ–π */
        }
        .calendar-table .past-event-day {
            background: #ff9999; /* –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –º–∏–Ω—É–ª–∏—Ö –ø–æ–¥—ñ–π */
        }
        .calendar-table .not-current {
            color: #999;
        }
        .calendar-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        .podii-2, .general-event {
            display: block;
            background: #e1e1e3;
            padding: 8px;
            width: 100%;
            max-width: 280px;
            text-align: center;
            text-decoration: none;
            color: #000;
            border-radius: 4px;
            margin: 10px 0;
        }
        .podii-2:hover, .general-event:hover {
            opacity: 0.9;
        }
        /* Styles for the event form modal */
        .box-modal {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }
        .box-modal_close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }
        .box-modal_close img {
            width: 20px;
            height: 20px;
        }
        .form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .input-box {
            display: flex;
            flex-direction: column;
        }
        .input-box label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-box input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form .button {
            text-align: center;
        }
        .form .button button {
            background: #e1e1e3;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .form .button button:hover {
            opacity: 0.9;
        }
        /* Styles for the event list */
        .list-event {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            width: 100%;
        }
        .list-event .event-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        .list-event .event-present.past {
            background: #ff9999; /* –ß–µ—Ä–≤–æ–Ω–∏–π –¥–ª—è –º–∏–Ω—É–ª–∏—Ö –ø–æ–¥—ñ–π */
        }
        .list-event .event-present.future {
            background: #ccffcc; /* –ó–µ–ª–µ–Ω–∏–π –¥–ª—è –º–∞–π–±—É—Ç–Ω—ñ—Ö –ø–æ–¥—ñ–π */
        }
        .list-event .event-absent {
            background: #f0f0f0;
        }

        /* Mobile responsiveness */
        @media (max-width: 767px) {
            .container {
                padding: 10px;
            }
            .row {
                flex-direction: column;
            }
            .col-12, .col-md-4, .col-md-8 {
                width: 100%;
                margin-bottom: 15px;
            }
            .button-column {
                align-items: center;
            }
            .admin-button {
                max-width: 100%;
                height: 34px;
                font-size: 14px;
                margin-top: 15px;
            }
            .calendar-wrapper {
                max-width: 100%;
                padding: 5px;
            }
            .calendar-header {
                flex-wrap: wrap;
                gap: 5px;
            }
            .calendar-header button {
                padding: 4px 8px;
                font-size: 14px;
            }
            .calendar-header span {
                font-size: 16px;
            }
            .calendar-table td {
                padding: 6px;
                font-size: 12px;
            }
            .calendar-buttons {
                margin-top: 15px;
            }
            .podii-2, .general-event {
                max-width: 100%;
                padding: 6px;
                font-size: 14px;
            }
            .box-modal {
                max-width: 90%;
                padding: 15px;
            }
            .box-modal h2 {
                font-size: 18px;
            }
            .input-box label {
                font-size: 14px;
            }
            .input-box input {
                font-size: 12px;
                padding: 6px;
            }
            .form .button button {
                font-size: 14px;
                padding: 8px 16px;
            }
            .list-event .event-item {
                padding: 6px;
                font-size: 12px;
            }
            .list-event .event-item p {
                margin: 0;
            }
        }

        @media (max-width: 576px) {
            .calendar-table td {
                padding: 4px;
                font-size: 10px;
            }
            .calendar-header button {
                padding: 3px 6px;
                font-size: 12px;
            }
            .calendar-header span {
                font-size: 14px;
            }
            .admin-button {
                font-size: 12px;
                height: 30px;
            }
            .podii-2, .general-event {
                font-size: 12px;
                padding: 5px;
            }
            .box-modal {
                padding: 10px;
            }
            .box-modal h2 {
                font-size: 16px;
            }
            .input-box label {
                font-size: 12px;
            }
            .input-box input {
                font-size: 10px;
                padding: 5px;
            }
            .form .button button {
                font-size: 12px;
                padding: 6px 12px;
            }
            .list-event .event-item {
                font-size: 10px;
                padding: 4px;
            }
        }
    </style>

    <script type="text/javascript">
        var Cal = function(divId) {
            this.divId = divId;
            this.DaysOfWeek = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–ù–¥'];
            this.Months = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å', '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];
            var d = new Date();
            this.currMonth = d.getMonth();
            this.currYear = d.getFullYear();
            this.currDay = d.getDate();
            this.events = [];
        };

        Cal.prototype.fetchEvents = async function() {
            try {
                const response = await fetch('/api/events', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                this.events = await response.json();
                console.log('–ü–æ–¥—ñ—ó –∑ API:', this.events);
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –ø–æ–¥—ñ–π:', error);
            }
        };

        Cal.prototype.nextMonth = function() {
            if (this.currMonth == 11) {
                this.currMonth = 0;
                this.currYear = this.currYear + 1;
            } else {
                this.currMonth = this.currMonth + 1;
            }
            this.showcurr();
        };

        Cal.prototype.previousMonth = function() {
            if (this.currMonth == 0) {
                this.currMonth = 11;
                this.currYear = this.currYear - 1;
            } else {
                this.currMonth = this.currMonth - 1;
            }
            this.showcurr();
        };

        Cal.prototype.showcurr = function() {
            this.showMonth(this.currYear, this.currMonth);
        };

        Cal.prototype.showMonth = function(y, m) {
            var d = new Date();
            var firstDayOfMonth = new Date(y, m, 7).getDay();
            var lastDateOfMonth = new Date(y, m + 1, 0).getDate();
            var lastDayOfLastMonth = m == 0 ? new Date(y - 1, 11, 0).getDate() : new Date(y, m, 0).getDate();

            // –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–∑–≤—É –º—ñ—Å—è—Ü—è —Ç–∞ —Ä–æ–∫—É
            document.getElementById('monthYear').textContent = this.Months[m] + ' ' + y;

            var html = '<table>';
            html += '<tr class="days">';
            for (var i = 0; i < this.DaysOfWeek.length; i++) {
                html += '<td>' + this.DaysOfWeek[i] + '</td>';
            }
            html += '</tr>';

            var i = 1;
            do {
                var dow = new Date(y, m, i).getDay();
                if (dow == 1) {
                    html += '<tr>';
                } else if (i == 1) {
                    html += '<tr>';
                    var k = lastDayOfLastMonth - firstDayOfMonth + 1;
                    for (var j = 0; j < firstDayOfMonth; j++) {
                        html += '<td class="not-current">' + k + '</td>';
                        k++;
                    }
                }

                var currentDate = new Date(y, m, i);
                var eventsForDay = this.events.filter(event => {
                    var eventDate = new Date(event.date);
                    return eventDate.getFullYear() === y &&
                           eventDate.getMonth() === m &&
                           eventDate.getDate() === i;
                });

                var hasEvent = eventsForDay.length > 0;
                var isPastEvent = false;
                if (hasEvent) {
                    const now = new Date();
                    isPastEvent = eventsForDay.every(event => {
                        const eventDate = new Date(event.date);
                        return eventDate < now;
                    });
                }

                var chk = new Date();
                var chkY = chk.getFullYear();
                var chkM = chk.getMonth();
                if (chkY == this.currYear && chkM == this.currMonth && i == this.currDay) {
                    html += `<td class="today${hasEvent ? (isPastEvent ? ' past-event-day' : ' event-day') : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
                } else {
                    html += `<td class="normal${hasEvent ? (isPastEvent ? ' past-event-day' : ' event-day') : ''}"><a href="#" class="but-block but-block-${i}" onclick="calendarInstance.showDayEvents(${y}, ${m}, ${i}); return false;">${i}</a></td>`;
                }

                if (dow == 0) {
                    html += '</tr>';
                } else if (i == lastDateOfMonth) {
                    var k = 1;
                    for (dow; dow < 7; dow++) {
                        html += '<td class="not-current">' + k + '</td>';
                        k++;
                    }
                }
                i++;
            } while (i <= lastDateOfMonth);

            html += '</table>';
            document.getElementById(this.divId).innerHTML = html;
        };

        Cal.prototype.showDayEvents = function(year, month, day) {
            const selectedDate = new Date(year, month, day);
            const dayOfWeek = this.DaysOfWeek[selectedDate.getDay() === 0 ? 6 : selectedDate.getDay() - 1];
            const dateStr = `${day} ${this.Months[month].toUpperCase()} ${year} - ${dayOfWeek}`;
            document.querySelector('#exampleModal-3 .date p').textContent = dateStr;

            const eventsOnDay = this.events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getFullYear() === year &&
                       eventDate.getMonth() === month &&
                       eventDate.getDate() === day;
            });

            const eventContainer = document.querySelector('#exampleModal-3 .desc-date');
            eventContainer.innerHTML = '';

            if (eventsOnDay.length > 0) {
                eventsOnDay.forEach(event => {
                    const eventDate = new Date(event.date);
                    const timeStr = eventDate.toTimeString().slice(0, 5);
                    const eventHtml = `
                        <div>
                            <h2 class="event-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'}</h2>
                            <p class="event-desc">–ß–∞—Å –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è: ${timeStr}</p>
                        </div>
                    `;
                    eventContainer.innerHTML += eventHtml;
                });
            } else {
                eventContainer.innerHTML = `
                    <p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∏—Ö –ø–æ–¥—ñ–π</p>
                `;
            }

            $.arcticmodal({
                content: '#exampleModal-3'
            });
        };

        Cal.prototype.showAllEvents = function() {
            document.getElementById('currentMonth').textContent = 
                this.Months[this.currMonth] + ' ' + this.currYear;

            const eventList = document.getElementById('eventList');
            eventList.innerHTML = '';

            const daysInMonth = new Date(this.currYear, this.currMonth + 1, 0).getDate();

            for (let day = 1; day <= daysInMonth; day++) {
                const eventsForDay = this.events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getFullYear() === this.currYear &&
                           eventDate.getMonth() === this.currMonth &&
                           eventDate.getDate() === day;
                });

                const li = document.createElement('li');
                li.classList.add('event-item');
                if (eventsForDay.length > 0) {
                    li.classList.add('event-present');
                    const now = new Date();
                    const isPastEvent = eventsForDay.every(event => {
                        const eventDate = new Date(event.date);
                        return eventDate < now;
                    });
                    li.classList.add(isPastEvent ? 'past' : 'future');
                    const eventTitlesWithTime = eventsForDay.map(event => {
                        const eventDate = new Date(event.date);
                        const hours = String(eventDate.getHours()).padStart(2, '0');
                        const minutes = String(eventDate.getMinutes()).padStart(2, '0');
                        const time = `${hours}:${minutes}`;
                        return `${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∏'} (${time})`;
                    }).join(', ');
                    li.innerHTML = `<p>${day}</p><p>${eventTitlesWithTime}</p>`;
                } else {
                    li.classList.add('event-absent');
                    li.innerHTML = `<p>${day}</p><p>–ù–µ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω—ñ—è–∫–∞ –ø–æ–¥—ñ—è</p>`;
                }
                eventList.appendChild(li);
            }

            $.arcticmodal({
                content: '#exampleModal-5'
            });
        };

        function showEventForm() {
            document.getElementById('formTitle').textContent = '–î–æ–¥–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω—É –ø–æ–¥—ñ—é';
            document.getElementById('formTitle').dataset.mode = 'add';
            document.getElementById('eventId').value = '';
            document.getElementById('eventTitle').value = '';

            flatpickr("#eventDate", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                defaultDate: new Date(),
                time_24hr: true,
                minuteIncrement: 1,
                locale: { firstDayOfWeek: 1 }
            });

            $.arcticmodal({
                content: '#exampleModal-10'
            });
        }

        async function saveEvent(event) {
            event.preventDefault();
            const eventId = document.getElementById('eventId').value;
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;

            if (!title || !date) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (–Ω–∞–∑–≤–∞ —ñ –¥–∞—Ç–∞)');
                return;
            }

            const eventDate = new Date(date);
            const year = eventDate.getFullYear();
            const month = String(eventDate.getMonth() + 1).padStart(2, '0');
            const day = String(eventDate.getDate()).padStart(2, '0');
            const hours = String(eventDate.getHours()).padStart(2, '0');
            const minutes = String(eventDate.getMinutes()).padStart(2, '0');
            const seconds = String(eventDate.getSeconds()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;

            const eventData = {
                title: title,
                date: formattedDate
            };

            try {
                let response;
                if (eventId) {
                    response = await fetch(`/api/events/${eventId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(eventData)
                    });
                } else {
                    response = await fetch('/api/events', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(eventData)
                    });
                }

                if (response.ok) {
                    await calendarInstance.fetchEvents();
                    calendarInstance.showcurr();
                    $.arcticmodal('close');
                } else {
                    alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–ø–∏—Ç—É:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –ø–æ–¥—ñ—ó');
            }
        }

        let calendarInstance;
        window.onload = async function() {
            calendarInstance = new Cal("divCal");
            await calendarInstance.fetchEvents();
            calendarInstance.showcurr();

            document.getElementById('btnNext').onclick = function() {
                calendarInstance.nextMonth();
            };
            document.getElementById('btnPrev').onclick = function() {
                calendarInstance.previousMonth();
            };

            document.querySelector('.podii-2').onclick = function(e) {
                e.preventDefault();
                calendarInstance.showAllEvents();
            };

            document.querySelector('.general-event').onclick = function(e) {
                e.preventDefault();
                showEventForm();
            };
        };
    </script>

    <script src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}"></script>
    <script type="text/javascript" src="{{url_for('static', filename='js/slick.min.js')}}"></script>
    <script type="text/javascript" src="{{url_for('static', filename='js/parallax-bg.js')}}"></script>
    <script src="{{url_for('static', filename='js/jquery.arcticmodal-0.3.min.js')}}"></script>
    <script type="text/javascript" src="{{url_for('static', filename='js/jquery.validate.js')}}"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="{{url_for('static', filename='js/main.js')}}"></script>
</div>
{% endblock %}